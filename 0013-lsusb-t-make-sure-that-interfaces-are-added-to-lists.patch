From 4e543ea8fe7a429c5aecebb9113d95056c4f5fba Mon Sep 17 00:00:00 2001
From: Lukas Nykryn <lnykryn@redhat.com>
Date: Tue, 26 Feb 2013 14:47:02 +0100
Subject: [PATCH 13/16] lsusb-t: make sure that interfaces are added to lists
 only once

https://bugzilla.redhat.com/show_bug.cgi?id=914929
---
 lsusb-t.c | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/lsusb-t.c b/lsusb-t.c
index 17c7050..38a5f37 100644
--- a/lsusb-t.c
+++ b/lsusb-t.c
@@ -256,8 +256,13 @@ static void read_sysfs_file_string(const char *d_name, const char *file, char *b
 
 static void append_dev_interface(struct usbinterface *i, struct usbinterface *new)
 {
-	while (i->next)
+	while (i->next) {
+		if (i == new)
+			return;
 		i = i->next;
+	}
+		if (i == new)
+			return;
 	i->next = new;
 }
 
@@ -276,8 +281,13 @@ static void append_businterface(unsigned int busnum, struct usbinterface *new)
 		if (b->busnum == busnum) {
 			i = b->first_interface;
 			if (i) {
-				while (i->next)
+				while (i->next) {
+					if (i == new)
+						return;
 					i = i->next;
+				}
+				if (i == new)
+					return;
 				i->next = new;
 			} else
 				b->first_interface = new;
-- 
2.4.3

